<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Paycheck Tracker ‚Äî Fixed Running Totals</title>
<style>
body{font-family:Arial,sans-serif;background:#FDF9F5;margin:0;padding:0;}
header{text-align:center;font-size:28px;padding:12px;}
#calendarWrapper{width:180px;margin:0 auto;}
.monthNav{display:flex;justify-content:center;align-items:center;gap:6px;margin:0 auto 6px auto;}
.monthNav button, .monthNav select{vertical-align:middle;font-size:14px;padding:4px 8px;border-radius:8px;border:none;cursor:pointer;}
#todayBtn{font-size:12px;padding:2px 6px;border-radius:6px;background:#FFD6A5;border:none;cursor:pointer;}
#miniCalendarContainer{width:180px;margin:0 auto;display:flex;justify-content:center;}
#miniCalendar{width:180px;border-collapse:collapse;}
#miniCalendar th,#miniCalendar td{width:18px;height:18px;font-size:9px;text-align:center;border:1px solid #ccc;cursor:pointer;}
#miniCalendar td.today{background:#FFB347;color:#fff;border-radius:50%;font-weight:bold;}
#miniCalendar td.selected{background:#FF7F50;color:#fff;border-radius:50%;font-weight:bold;}
.dashboard{display:flex;justify-content:space-around;align-items:center;background:#FFF3E0;padding:10px;margin:10px;border-radius:10px;font-size:15px;}
.section{margin:10px;}
table{width:100%;border-collapse:collapse;box-shadow:0 2px 6px rgba(0,0,0,0.1);border-radius:8px;overflow:hidden;}
table tbody{display:block;max-height:200px;overflow-y:auto;}
table thead,table tbody tr{display:table;width:100%;table-layout:fixed;}
th,td{border:1px solid #ccc;padding:3px 5px;font-size:12px;text-align:center;height:30px;}
table input[type="text"],table input[type="number"],table input[type="date"]{width:95%;box-sizing:border-box;padding:2px 3px;font-size:11px;text-align:center;border-radius:4px;border:1px solid #ccc;}
.addEntryBtn{font-size:13px;padding:6px 10px;border-radius:10px;background:#FFD6A5;border:none;cursor:pointer;margin:4px 0;}
button.removeBtn{background:#FFA3A3;color:#fff;border:none;border-radius:6px;padding:3px 6px;cursor:pointer;font-size:10px;}
button.removeBtn:hover{background:#FF7B7B;}
.switch{position:relative;display:inline-block;width:32px;height:16px;}
.switch input{opacity:0;width:0;height:0;}
.slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:#d1d5db;border-radius:24px;transition:.4s;}
.slider:before{position:absolute;content:"";height:12px;width:12px;left:2px;bottom:2px;background:#fff;border-radius:50%;transition:.4s;}
input:checked+.slider{background:#4CAF50;border:1px solid #3A8E40;}
input:checked+.slider:before{transform:translateX(16px);}
#incomeTable tbody tr:hover,#billTable tbody tr:hover{background: #FFF1B5; transition: background 0.3s;}
#incomeTable tbody tr[style*="B9FBC1"],#billTable tbody tr[style*="B9FBC1"]{background: linear-gradient(to right, #B9FBC1, #D1FFD6);}
#incomeTable tbody tr[style*="FFE4E1"],#billTable tbody tr[style*="FFE4E1"]{background: linear-gradient(to right, #FFE4E1, #FFD1D1);}
</style>
</head>
<body>

<header>üí∞ Paycheck Tracker</header>

<div id="calendarWrapper">
  <div class="monthNav">
    <button id="prevMonth">‚óÄ</button>
    <select id="monthSelect"></select>
    <select id="yearSelect"></select>
    <button id="nextMonth">‚ñ∂</button>
    <button id="todayBtn">Today</button>
  </div>
  <div id="miniCalendarContainer">
    <table id="miniCalendar">
      <thead>
        <tr><th>Su</th><th>Mo</th><th>Tu</th><th>We</th><th>Th</th><th>Fr</th><th>Sa</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<div class="dashboard">
  <div>Total Income: $<span id="dashIncome">0</span></div>
  <div>Total Bills: $<span id="dashBills">0</span></div>
  <div>Left: $<span id="dashLeft">0</span></div>
</div>

<div class="section">
<h3>Income</h3>
<button id="addIncomeBtn" class="addEntryBtn">‚ûï Add Income</button>
<table id="incomeTable">
<thead><tr>
<th>Type</th><th>Description</th><th>Date Received</th><th>Expected</th><th>Actual</th><th>Remove</th>
</tr></thead><tbody></tbody>
</table>
</div>

<div class="section">
<h3>Bills</h3>
<button id="addBillBtn" class="addEntryBtn">‚ûï Add Bill</button>
<table id="billTable">
<thead><tr>
<th>Bill Name</th><th>Date Due</th><th>Amount</th><th>Paid?</th><th>Date Paid</th><th>Remove</th>
</tr></thead><tbody></tbody>
</table>
</div>

<script>
// Utilities
function localISODate(y,m,d){const mm=String(m+1).padStart(2,'0');const dd=String(d).padStart(2,'0');return `${y}-${mm}-${dd}`;}
function parseLocalDate(str){if(!str) return null;const [y,m,d]=str.split('-').map(Number);return new Date(y,m-1,d);}

// Data
let incomes=JSON.parse(localStorage.getItem("incomes"))||[];
let bills=JSON.parse(localStorage.getItem("bills"))||[];
let currentDate=new Date();
let selectedDay=currentDate.getDate();
function saveData(){localStorage.setItem("incomes",JSON.stringify(incomes));localStorage.setItem("bills",JSON.stringify(bills));}

// Calendar setup
const monthSelect=document.getElementById("monthSelect");
const yearSelect=document.getElementById("yearSelect");
const prevMonth=document.getElementById("prevMonth");
const nextMonth=document.getElementById("nextMonth");
const todayBtn=document.getElementById("todayBtn");

for(let m=0;m<12;m++){const o=document.createElement("option");o.value=m;o.text=new Date(2000,m,1).toLocaleString('default',{month:'short'});monthSelect.appendChild(o);}
for(let y=currentDate.getFullYear()-5;y<=currentDate.getFullYear()+5;y++){const o=document.createElement("option");o.value=y;o.text=y;yearSelect.appendChild(o);}
monthSelect.value=currentDate.getMonth();
yearSelect.value=currentDate.getFullYear();

monthSelect.onchange=()=>{currentDate.setMonth(+monthSelect.value);render();}
yearSelect.onchange=()=>{currentDate.setFullYear(+yearSelect.value);render();}
prevMonth.onclick=()=>{currentDate.setMonth(currentDate.getMonth()-1);selectedDay=null;monthSelect.value=currentDate.getMonth();yearSelect.value=currentDate.getFullYear();render();}
nextMonth.onclick=()=>{currentDate.setMonth(currentDate.getMonth()+1);selectedDay=null;monthSelect.value=currentDate.getMonth();yearSelect.value=currentDate.getFullYear();render();}
todayBtn.onclick=()=>{currentDate=new Date();selectedDay=currentDate.getDate();monthSelect.value=currentDate.getMonth();yearSelect.value=currentDate.getFullYear();render();};

// Render mini-calendar
function renderMiniCalendar(){
  const body=document.querySelector("#miniCalendar tbody");
  body.innerHTML="";
  const m=currentDate.getMonth(),y=currentDate.getFullYear();
  const firstDay=new Date(y,m,1).getDay();
  const lastDate=new Date(y,m+1,0).getDate();
  let row=document.createElement("tr");
  for(let i=0;i<firstDay;i++) row.appendChild(document.createElement("td"));
  for(let d=1;d<=lastDate;d++){
    const td=document.createElement("td");
    td.textContent=d;
    const today=new Date();
    if(d===today.getDate()&&m===today.getMonth()&&y===today.getFullYear()) td.classList.add("today");
    if(d===selectedDay) td.classList.add("selected");
    td.onclick=()=>{selectedDay=d;render();};
    row.appendChild(td);
    if((firstDay+d)%7===0){body.appendChild(row);row=document.createElement("tr");}
  }
  if(row.children.length>0)body.appendChild(row);
}

// Update dashboard with fixed running totals
function updateDashboard(){
  const y=currentDate.getFullYear();
  const m=currentDate.getMonth();

  let carryover=0;
  for(let i=0;i<m;i++){
    const prevIncome=incomes.filter(e=>{const d=parseLocalDate(e.date);return d&&d.getFullYear()===y&&d.getMonth()===i;}).reduce((s,e)=>s+(+e.actual||0),0);
    const prevBills=bills.filter(b=>{const d=parseLocalDate(b.date);return d&&d.getFullYear()===y&&d.getMonth()===i;}).reduce((s,b)=>s+(+b.amount||0),0);
    carryover+=prevIncome-prevBills;
  }

  const currentIncome=incomes.filter(e=>{
    const d=parseLocalDate(e.date);if(!d)return false;
    return d.getFullYear()===y&&d.getMonth()===m&&(!selectedDay||d.getDate()<=selectedDay);
  }).reduce((s,i)=>s+(+i.actual||0),0);

  const billsThisMonth=bills.filter(b=>{
    const d=parseLocalDate(b.date);
    return d&&d.getFullYear()===y&&d.getMonth()===m;
  }).reduce((s,b)=>s+(+b.amount||0),0);

  const earlyPaid=bills.filter(b=>{
    const paid=parseLocalDate(b.paidDate);
    const due=parseLocalDate(b.date);
    return paid&&paid.getFullYear()===y&&paid.getMonth()===m&&due.getMonth()>m;
  }).reduce((s,b)=>s+(+b.amount||0),0);

  const totalIncome=carryover+currentIncome;
  const totalBills=billsThisMonth;
  const leftover=totalIncome-totalBills-earlyPaid;

  document.getElementById("dashIncome").textContent=totalIncome.toFixed(2);
  document.getElementById("dashBills").textContent=totalBills.toFixed(2);
  document.getElementById("dashLeft").textContent=leftover.toFixed(2);
}

// Render tables
function render(){
  renderMiniCalendar();
  updateDashboard();

  const it=document.querySelector("#incomeTable tbody");it.innerHTML="";
  incomes.forEach((i,x)=>{
    const d=parseLocalDate(i.date);
    if(d && d.getFullYear()===currentDate.getFullYear() && d.getMonth()===currentDate.getMonth() && (!selectedDay || d.getDate()===selectedDay)){
      const tr=document.createElement("tr");tr.style.background=i.receivedDate?"#B9FBC1":"#FFE4E1";
      tr.innerHTML=`
      <td><input type="text" value="${i.type||'Salary'}" onchange="incomes[${x}].type=this.value;saveData();"></td>
      <td><input type="text" value="${i.description||''}" onchange="incomes[${x}].description=this.value;saveData();"></td>
      <td><input type="date" value="${i.date||localISODate(currentDate.getFullYear(),currentDate.getMonth(),selectedDay)}" onchange="incomes[${x}].date=this.value;saveData();"></td>
      <td><input type="number" placeholder="$0.00" value="${i.expected||0}" onfocus="if(this.value=='0'){this.value='';}" onblur="if(this.value===''){this.value='0';}" onchange="incomes[${x}].expected=parseFloat(this.value.replace(/\$/g,''))||0;saveData();"></td>
      <td><input type="number" placeholder="$0.00" value="${i.actual||0}" onfocus="if(this.value=='0'){this.value='';}" onblur="if(this.value===''){this.value='0';}" onchange="incomes[${x}].actual=parseFloat(this.value.replace(/\$/g,''))||0;saveData();"></td>
      <td><button class='removeBtn' onclick='incomes.splice(${x},1);saveData();render();'>üóëÔ∏è</button></td>`;it.appendChild(tr);}
  });

  const bt=document.querySelector("#billTable tbody");bt.innerHTML="";
  bills.forEach((b,x)=>{
    const d=parseLocalDate(b.date);
    if(d && d.getFullYear()===currentDate.getFullYear() && d.getMonth()===currentDate.getMonth() && (!selectedDay || d.getDate()===selectedDay)){
      const tr=document.createElement("tr");tr.style.background=b.paidDate?"#B9FBC1":"#FFE4E1";
      tr.innerHTML=`
      <td><input type="text" value="${b.name||''}" onchange="bills[${x}].name=this.value;saveData();"></td>
      <td><input type="date" value="${b.date||localISODate(currentDate.getFullYear(),currentDate.getMonth(),selectedDay)}" onchange="bills[${x}].date=this.value;saveData();"></td>
      <td><input type="number" placeholder="$0.00" value="${b.amount||0}" onfocus="if(this.value=='0'){this.value='';}" onblur="if(this.value===''){this.value='0';}" onchange="bills[${x}].amount=parseFloat(this.value.replace(/\$/g,''))||0;saveData();"></td>
      <td><label class='switch'><input type='checkbox' ${b.paidDate?'checked':''} onchange="bills[${x}].paidDate=this.checked?localISODate(currentDate.getFullYear(),currentDate.getMonth(),selectedDay):'';saveData();render();"><span class='slider'></span></label></td>
      <td><input type="date" value="${b.paidDate||''}" onchange="bills[${x}].paidDate=this.value;saveData();"></td>
      <td><button class='removeBtn' onclick='bills.splice(${x},1);saveData();render();'>üóëÔ∏è</button></td>`;bt.appendChild(tr);}
  });
}

// Add buttons
document.getElementById("addIncomeBtn").onclick=()=>{
  const dateStr=localISODate(currentDate.getFullYear(),currentDate.getMonth(),selectedDay);
  incomes.push({type:'Salary',description:'',date:dateStr,actual:0,expected:0,receivedDate:''});
  saveData();render();
};
document.getElementById("addBillBtn").onclick=()=>{
  const dateStr=localISODate(currentDate.getFullYear(),currentDate.getMonth(),selectedDay);
  bills.push({name:'Bill',date:dateStr,amount:0,paidDate:''});
  saveData();render();
};

render();
</script>
</body>
</html>